# Ultimate Fields Showcase: Menu

The Menu module of the Ultimate Fields Showcase theme extends the functionality of WordPress menus by allowing users to select an icon for each menu item and to switch to a "mega menu", which uses a custom sidebar within the dropdown.

## Used features

- The [Menu Item](https://www.ultimate-fields.com/docs/locations/menu-item/) location
- The [Icon](https://www.ultimate-fields.com/fields/icon/), [Select](https://www.ultimate-fields.com/fields/select/) and [Sidebar](https://www.ultimate-fields.com/fields/sidebar/) fields

## Registering fields

As always, fields are registered on the `uf.init` action, in this case by the `showcase_menu_fields` function. In it, we are creating a single container, which should only appear on first-level menu items.

```php
Field::create( 'icon', 'menu_icon', __( 'Icon', 'showcase' ) )
	->add_set( 'font-awesome' )
	->set_output_format( 'icon' ),
Field::create( 'select', 'sub_menu_type', __( 'Sub menu', 'showcase' ) )
	->set_input_type( 'radio' )
	->add_options(array(
		'normal'  => __( 'Display sub-menu items', 'showcase' ),
		'widgets' => __( 'Display widgets', 'showcase' )
	)),
Field::create( 'sidebar', 'menu_sidebar', __( 'Sidebar', 'showcase' ) )
	->add_dependency( 'sub_menu_type', 'widgets' )
	->make_editable()
```

The fields array contains:

1. An icon field, which is always available.
2. A sub-menu type selector. Users can check if they'd like to display the standard sub-menu items or a sidebar with widgets.
3. A sidebar field, which only appears when "Display widgets" is chosen and allows users to create new sidebars because of the `make_editable` method.

## Adding icons to menu items

WordPress allows the content of menu links (not items) to be changed through the `nav_menu_item_title` filter. By assigning the `showcase_menu_item_title` function to the filter, we can check if an icon exists and if it does, to add it to the beginning of the link.

```php
function showcase_menu_item_title( $title, $item, $args, $depth ) {
	// Ignore non-top-level items
	if( $depth > 0 ) {
		return $title;
	}

	// Check for an icon
	if( $icon = get_value( 'menu_icon', $item->ID ) ) {
		// Generate the icon
		$icon = '<span class="menu-icon">' . get_the_value( 'menu_icon', $item->ID ) . '</span>';
		$title = $icon . $title;
	}

	return $title;
}
```

## Displaying widgets as drop-downs

While adding an icon to menu items is relatively simple, changing dropdowns is a bit more complicated. To do so, we need to extend the class, which normally renders navigation menus, `Walker_Nav_Menu`.

For the module the walker class is extended by `Showcase_Menu_Walker`, located in `class-showcase-menu-walker.php`. The class has two methods:

### `start_el`

This method normally starts an individual menu item. To render the sidebar, we will not be modifying the actual output, generated by the method. Instead, we will work with the arguments for the menu, more specifically `$args->after`. Normally this argument is empty, but for specific items, we can overwrite it.

Within the method we are doing this:

```php
if( 0 === $depth && 'widgets' == get_value( 'sub_menu_type', $item->ID ) ) {
	$args->after = $this->render_sidebar( get_value( 'menu_sidebar', $item->ID ) );
	$item->classes[] = 'has-mega-menu';
}
```

As you can see, we are checking whether the menu item is a top-level one and whether `widgets` has been selected as the sub-menu type. If it is, we are using the `render_sidebar` method in order to append the sidebar to the menu item.

### `render_sidebar`
